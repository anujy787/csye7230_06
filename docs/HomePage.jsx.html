<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: HomePage.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: HomePage.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { useNavigate } from 'react-router-dom';
import './HomePage.css';
import Modal from 'react-modal';
import MapWithSearch from './MapWithSearch';
import Chatbot from 'react-chatbot-kit';
import 'react-chatbot-kit/build/main.css'; // Import chatbot styling
import chatbotConfig from '../chatbotConfig'; // Adjust the path as necessary
import ActionProvider from "../ActionProvider";
import MessageParser from "../MessageParser";

Modal.setAppElement('#root');
/**
 * HomePage - Component for the home page of the application.
 * Handles displaying plans, creating new plans, server health checks, and chatbot integration.
 * @returns {JSX.Element} - A React element.
 */
const HomePage = () => {
    const apikey = "zr2tbVV14UOQ4QErFvjekLiNriVrYhBc8qZyqGf5jRntcsIzBPLMozCu"
    // const apikey = ""
    const navigate = useNavigate();
    const [plans, setPlans] = useState([]);

    const [modalOpen, setModalOpen] = useState(false);
    const [selectedPlan, setSelectedPlan] = useState(null);
    const auth = JSON.parse(sessionStorage.getItem('auth'));
    const isLoggedIn = auth &amp;&amp; auth.username &amp;&amp; auth.password;

    useEffect(() => {
        if (isLoggedIn) {
            fetchAllPlans();
        }
    }, [isLoggedIn]);

    /**
     * Fetch all plans from the server.
     */

    const fetchAllPlans = async () => {
        try {
           
             axios.defaults.headers.common['Authorization'] = `Basic ${btoa(`${auth.username}:${auth.password}`)}`;

            const response = await axios.get('http://localhost:8000/v1/allplans/');
            setPlans(response.data);
            
        } catch (error) {
            console.error('Error fetching plans:', error);
        }
    };

     /**
     * Handle server health check.
     */

    const handleHealthCheck = async () => {
        try {
            const response = await axios.get('http://localhost:8000/healthz/');
            alert('Very Healthy 🚀');
        } catch (error) {
            alert('Not Healthy ❌');
            console.error('Error checking server health:', error);
        }
    };

    const handlePlanJoin = (id) => {
        console.log(id);
    };

    /**
     * Open modal for displaying plan details.
     * @param {object} plan - The selected plan object.
     */

    const openModal = async(plan1) => {
        if(plan1.link_to_map == null){
            await handleImageSearch(plan1.destination);
            try{
                const auth = JSON.parse(sessionStorage.getItem('auth'));
                const response = await axios.put(`http://localhost:8000/v1/plan/self/${plan1.plan_id}`,{
                    link_to_map: imageUrl
                },{
                    auth: {
                        username: auth.username,
                        password: auth.password
                    }
                });
            }
            catch(err){
                alert(err)
            }
        }
        setSelectedPlan(plan1);
        setModalOpen(true);
    };

    /**
     * Close modal.
     */

    const closeModal = () => {
        setModalOpen(false);
        setSelectedPlan(null);
    };

    const customStyles = {
        overlay: {zIndex: 10}
      };

    const [imageUrl, setImageUrl] = useState('');
    /**
     * Handle image search for a destination.
     * @param {string} destination - The destination for image search.
     */
    const handleImageSearch = async (destination) => {
        try {

            const response = await axios.get(`https://api.pexels.com/v1/search?query=${destination}`, {
                headers: {
                    Authorization: apikey
                }
            });
            setImageUrl(response.data.photos[0].src.original);
            
        } catch (error) {
            console.error('Error searching for images:', error);
        }
    };
    
    // create plan modal
    const [createModalOpen, setCreateModalOpen] = useState(false);
    /**
     * Open modal for creating a new plan.
     */
    const openCreateModal = () => {
        setCreateModalOpen(true);
    };
    /**
     * Close create plan modal.
     */
    const closeCreateModal = () => {
        setCreateModalOpen(false);
    };

    const [newPlan, setNewPlan] = useState({
        planned_date: '',
        name: '',
        source: '',
        destination: '',
        preference: '',
        status: ''
    });
    /**
     * Handle creating a new plan.
     */
    const handleCreatePlan = async() => {
        try{
            const auth = JSON.parse(sessionStorage.getItem('auth'));
            const response = await axios.post('http://localhost:8000/v1/plan',newPlan, {
              auth: {
                username: auth.username,
                password: auth.password
              }
            });
          } 
          catch(err) {
            alert(err)
          }
    };
    /**
     * Handle input change for new plan form.
     * @param {object} e - The event object.
     */

    const handleInputChange = (e) => {
        setNewPlan({
            ...newPlan,
            [e.target.name]: e.target.value
        });
    };
    // function to chage map for create
    const [createlocation, setCreatelocation] = useState('Boston');
    /**
     * Change map location for create plan.
     * @param {object} e - The event object.
     */
    const changeMap = (e) => {
        setCreatelocation(e.target.value);
    };

    const [showChatbot, setShowChatbot] = useState(false);
    /**
     * Toggle chatbot visibility.
     */
    const toggleChatbot = () => {
        setShowChatbot(!showChatbot);
    };
      

    return (
        &lt;div className="container">
            &lt;div className="header-container">
                &lt;header className="header">
                    &lt;div className="header-buttons">
                    {!isLoggedIn &amp;&amp; (
                            &lt;>
                                &lt;button className="header-button" onClick={() => navigate('/login')}>Login&lt;/button>
                                &lt;button className="header-button" onClick={() => navigate('/register')}>Signup&lt;/button>
                            &lt;/>
                        )}
                        {isLoggedIn &amp;&amp; (
                            &lt;button className="header-button" onClick={() => navigate('/user-profile')}>Profile&lt;/button>
                        )}
                        &lt;button className="header-button" onClick={() => navigate('/contactus')}>Contact Us&lt;/button>
                    &lt;/div>
                &lt;/header>
                &lt;div>
                    &lt;button className="chat-bot-button" onClick={toggleChatbot}>Assistant&lt;/button>
            {showChatbot &amp;&amp; (
                &lt;Chatbot
                    config={chatbotConfig}
                    actionProvider={ActionProvider}
                    messageParser={MessageParser}
                    style={{
                        position: 'absolute',
                        bottom: '20px',
                        right: '20px',
                        zIndex: '9999', // Ensure the chatbot is on top of other elements
                    }}
                />
                )}
                    &lt;/div>
            &lt;/div>
            
            &lt;div className="image-container">
                &lt;img src={require('../assets/vverse-logo.png')} alt="VVerse Logo" className="full-width-image" />
            &lt;/div>
            &lt;div className="content-container">
                &lt;div className="section">
                    &lt;h1 style={{ textAlign: 'center', fontWeight:'bold' }}>All Plans&lt;/h1>
                    &lt;div className="card-container">
                        {plans.map((plan, index) => (
                            &lt;div key={index} className="card">
                                &lt;img className="card-image" src={plan.link_to_map} alt="" />
                                &lt;h2>{plan.name}&lt;/h2>
                                &lt;p>&lt;strong>Destination:&lt;/strong> {plan.destination}&lt;/p>
                                &lt;button onClick={() => handlePlanJoin(plan)}>Join Now&lt;/button>
                                &lt;button onClick={() => openModal(plan)}>View Plans&lt;/button>
                            &lt;/div>
                        ))}
                    &lt;/div>
                    &lt;h1 style={{ textAlign: 'center', fontWeight:'bold' }}>Created Plans &lt;button onClick={() => openCreateModal()}>+&lt;/button>&lt;/h1>
                    &lt;div className="card-container">
                        {plans.map((plan, index) => (
                            &lt;div key={index} className="card">
                                &lt;h2>{plan.name}&lt;/h2>
                                &lt;p>&lt;strong>Source:&lt;/strong> {plan.source}&lt;/p>
                                &lt;p>&lt;strong>Destination:&lt;/strong> {plan.destination}&lt;/p>
                                &lt;button onClick={() => handlePlanJoin(plan)}>Join Now&lt;/button>
                                &lt;button onClick={() => openModal(plan)}>View Plans&lt;/button>
                            &lt;/div>
                        ))}
                    &lt;/div>
                &lt;/div>
            &lt;/div>
            &lt;button onClick={handleHealthCheck}>Server Health Check&lt;/button>
            

            &lt;Modal
                isOpen={modalOpen}
                onRequestClose={closeModal}
                style={customStyles}
                className="plan-modal"
            >
                &lt;button onClick={closeModal}>Close Modal&lt;/button>
                {selectedPlan &amp;&amp; (
                    &lt;div>
                        &lt;h2>{selectedPlan.name}&lt;/h2>
                        &lt;div className="modal-card-container">
                            &lt;p className="modal-card">&lt;strong>Created By:&lt;/strong> {selectedPlan.created_by}&lt;/p>
                            &lt;p className="modal-card">&lt;strong>Planned Date:&lt;/strong> {selectedPlan.planned_date}&lt;/p>
                            &lt;p className="modal-card">&lt;strong>Destination:&lt;/strong> {selectedPlan.destination}&lt;/p>
                            &lt;p className="modal-card">&lt;strong>Status:&lt;/strong> {selectedPlan.status}&lt;/p>
                        &lt;/div>
                        &lt;p className="modal-card-preference">&lt;strong>Preference:&lt;/strong>Lorem ipsum dolor sit amet consectetur adipisicing elit. Esse sapiente et quod fugiat illo quam eius at laborum excepturi officiis accusantium blanditiis repellat magnam doloribus nulla commodi, molestiae rem. Perferendis!&lt;/p>
                        &lt;img src={selectedPlan.link_to_map} alt="Destination" className="modal-image" />
                        &lt;div className="map-container">
                            &lt;MapWithSearch searchTerm={selectedPlan.destination} />
                        &lt;/div>
   
                    &lt;/div>
                )}
            &lt;/Modal>


            {/* Create Plan Modal */}
            &lt;Modal
                isOpen={createModalOpen}
                onRequestClose={closeCreateModal}
                style={customStyles}
                className="plan-modal"
            >
                &lt;button onClick={closeCreateModal}>Close Modal&lt;/button>
                &lt;div>
                    &lt;h2>Create New Plan&lt;/h2>
                    {/* Form for creating a new plan */}
                    &lt;div className="modal-card-container">
                        &lt;input type="text" className="modal-card" name="planned_date" onChange={handleInputChange} placeholder='Planned Date (YYYY-MM-DD)' />
                        &lt;input type="text" className="modal-card" name="destination" onChange={(event) => {
                            handleInputChange(event);
                            changeMap(event);
                        }}
                        placeholder='Destination' />
                        &lt;input type="text" className="modal-card" name="preference" onChange={handleInputChange} placeholder='Preference' />
                        &lt;input type="text" className="modal-card" name="source" onChange={handleInputChange} placeholder='Source' />
                        &lt;input type="text" className="modal-card" name="status" onChange={handleInputChange} placeholder='Status' />
                        &lt;input type="text" className="modal-card" name="name" onChange={handleInputChange} placeholder='Name'/>
                        &lt;button type="submit" onClick={handleCreatePlan} className="modal-card">Create&lt;/button>
                    &lt;/div>
                    &lt;div className="map-container">
                            &lt;MapWithSearch searchTerm={createlocation} />
                    &lt;/div>
                &lt;/div>
            &lt;/Modal>
        &lt;/div>
    );
};

export default HomePage;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ContactUs">ContactUs</a></li><li><a href="global.html#ForgotPassword">ForgotPassword</a></li><li><a href="global.html#HomePage">HomePage</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#MapWithSearch">MapWithSearch</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#StarRating">StarRating</a></li><li><a href="global.html#SubscriptionPage">SubscriptionPage</a></li><li><a href="global.html#UserProfile">UserProfile</a></li><li><a href="global.html#VerifyEmail">VerifyEmail</a></li><li><a href="global.html#ViewPlans">ViewPlans</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Apr 12 2024 14:29:11 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
